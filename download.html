<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>M.M Public School Mundeshwari â€“ Downloads</title>
<meta name="description"
content="M.M Public School Mundeshwari Official Website. Online Admission, Notes, Test Series, Demo Class, Student Portal and School Updates.">

<meta name="keywords"
content="MM Public School Mundeshwari, school website, online admission, student portal, demo class, notes download, Bihar school">

<meta name="author" content="M.M Public School Mundeshwari">

<meta name="robots" content="index, follow">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Search Verification (à¤¬à¤¾à¤¦ à¤®à¥‡à¤‚ code à¤®à¤¿à¤²à¥‡à¤—à¤¾ à¤¤à¥‹ à¤¯à¤¹à¤¾à¤ à¤¡à¤¾à¤²à¤¨à¤¾) -->
<meta name="google-site-verification" content="PASTE_YOUR_CODE_HERE">
<link rel="stylesheet" href="style.css">
<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>

<!-- ===== HEADER ===== -->
<header class="header">

<div class="menu-icon">
<i class="fa-solid fa-bars"></i>
</div>

<div class="school-box">
<div class="school-top">M. M PUBLIC SCHOOL</div>
<div class="school-bottom">MUNDESHWARI</div>
</div>

<div class="right-icons">
<div class="notification-icon" id="openNotif">
<i class="fa-regular fa-bell"></i>
<span class="notif-count" id="notifCount">0</span>
</div>

<a href="signup.html">
<i class="fa-solid fa-user-plus"></i>
</a>
</div>

</header>

<!-- ðŸ”” NOTIFICATION POPUP -->
<div class="notif-popup" id="notifPopup">
<div class="notif-head">
Notifications
<button id="clearNotif">Clear</button>
</div>
<div id="notifList"></div>
</div>

<!-- CLEAR CONFIRM -->
<div class="confirm-dialog" id="confirmDialog">
<div class="dialog-box">
<div class="dialog-title">Clear Notifications</div>
<div class="dialog-text">Are you sure you want to delete all notifications?</div>
<div class="dialog-actions">
<button class="cancel-btn" id="cancelClear">Cancel</button>
<button class="ok-btn" id="confirmClear">Delete</button>
</div>
</div>
</div>

<!-- ===== TITLE ===== -->
<section style="padding:14px;font-weight:800;font-size:16px;">
Downloads
</section>

<section class="apps-section" id="downloadList"></section>

<!-- ===== FILE VIEWER ===== -->
<div id="fileViewer" style="position:fixed;inset:0;background:#000;display:none;z-index:9999;">
<div id="closeViewer"
style="position:absolute;top:12px;right:14px;color:#fff;font-size:24px;cursor:pointer;">
<i class="fa-solid fa-xmark"></i>
</div>
<iframe id="viewerFrame"
style="width:100%;height:100%;border:none;background:#fff;"></iframe>
</div>

<!-- ===== ACTION DIALOG ===== -->
<div id="actionDialog" class="confirm-dialog">
<div class="dialog-box" id="dialogBox">

<div class="dialog-title">Choose Action</div>

<div style="font-size:12px;margin-bottom:14px;color:#555;">
You can view this file inside the website or remove it from the download list.
This action will not affect original file storage.
</div>

<div class="dialog-actions">

<button class="cancel-btn" id="viewBtn">
<i class="fa-regular fa-eye"></i> View
</button>

<button class="ok-btn" id="deleteBtn">
<i class="fa-solid fa-trash"></i> Delete
</button>

</div>

</div>
</div>

<!-- ===== NAV ===== -->
<nav class="bottom-nav">

<a href="index.html" class="nav-item">
<i class="fa-solid fa-house"></i>
<span>Home</span>
</a>

<a href="download.html" class="nav-item active">
<i class="fa-solid fa-download"></i>
<span>Download</span>
</a>

<a href="notes.html" class="nav-item">
<i class="fa-solid fa-book"></i>
<span>Notes</span>
</a>

<a href="profile.html" class="nav-item">
<i class="fa-solid fa-user"></i>
<span>Profile</span>
</a>

</nav>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, onValue, remove }
from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig={
apiKey:"AIzaSyAHAQjn4sTuR9FiGF3ljRrFEMZQjsx-SHg",
databaseURL:"https://apni-duniya-b53d7-default-rtdb.firebaseio.com",
projectId:"apni-duniya-b53d7"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

const list=document.getElementById("downloadList");

const fileViewer=document.getElementById("fileViewer");
const viewerFrame=document.getElementById("viewerFrame");

const dialog=document.getElementById("actionDialog");
const dialogBox=document.getElementById("dialogBox");

const viewBtn=document.getElementById("viewBtn");
const deleteBtn=document.getElementById("deleteBtn");

/* TIME */
function timeAgo(ts){
const diff=Math.floor((Date.now()-ts)/60000);
if(diff<=0) return "Just now";
if(diff==1) return "1 min";
return diff+" min";
}

/* ===== DOWNLOAD LIST ===== */
onValue(ref(db,"downloads"),snap=>{

list.innerHTML="";

if(!snap.exists()){
list.innerHTML=`
<div class="empty-msg">
No PDF, notes or documents have been downloaded yet.<br>
Files downloaded from notes or other sections will appear here automatically.
</div>`;
return;
}

snap.forEach(c=>{
const d=c.val();

list.innerHTML+=`
<div class="app-card"
onclick="showDialog('${c.key}','${d.link}')">

<i class="fa-solid fa-file-arrow-down"></i>
<span>${d.name}</span>

<div class="time">${timeAgo(d.time)}</div>

<div style="font-size:11px;color:#666;">
Total Download: ${d.count||1}
</div>

</div>`;
});

});

/* ===== VIEWER ===== */
window.openViewer=(link)=>{
fileViewer.style.display="block";
viewerFrame.src=link;
};

closeViewer.onclick=()=>{
fileViewer.style.display="none";
viewerFrame.src="";
};

dialog.addEventListener("click",(e)=>{
if(!dialogBox.contains(e.target)){
dialog.style.display="none";
}
});

window.showDialog=(key,link)=>{
selectedKey=key;
selectedLink=link;
dialog.style.display="flex";
};

viewBtn.onclick=()=>{
dialog.style.display="none";
openViewer(selectedLink);
};

deleteBtn.onclick=()=>{
remove(ref(db,"downloads/"+selectedKey));
dialog.style.display="none";
};

/* ===== NOTIFICATION SYSTEM SAME AS PROFILE ===== */
openNotif.onclick=e=>{
e.stopPropagation();
notifPopup.style.display="block";
};

document.addEventListener("click",e=>{
if(!notifPopup.contains(e.target)&&!openNotif.contains(e.target)){
notifPopup.style.display="none";
}
});

clearNotif.onclick=()=>{
confirmDialog.style.display="flex";
};

cancelClear.onclick=()=>confirmDialog.style.display="none";

confirmClear.onclick=()=>{
remove(ref(db,"notifications"));
confirmDialog.style.display="none";
};

onValue(ref(db,"notifications"),snap=>{

notifList.innerHTML="";
let arr=[];
let total=0;

snap.forEach(c=>arr.push(c.val()));

if(arr.length===0){
notifList.innerHTML=
`<div class="empty-msg">
No notification has been sent by M. M Public School.
</div>`;
notifCount.innerText="0";
openNotif.classList.remove("bell-blink");
return;
}

arr.sort((a,b)=>a.type==="important"?-1:1);

arr.forEach(d=>{
total++;
notifList.innerHTML+=`
<div class="notif-item ${d.type==="important"?"important":""}">
${d.text}
<div class="time">${timeAgo(d.time)}</div>
</div>`;
});

notifCount.innerText=total>9?"9+":total;

if(total>0){
openNotif.classList.add("bell-blink");
}
});

</script>

</body>
</html>