<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Admin Panel - M. M Public School</title>

<link rel="stylesheet" href="style.css">
<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>

<header class="header">
<div class="school-box">
<div class="school-top">ADMIN PANEL</div>
<div class="school-bottom">M. M PUBLIC SCHOOL</div>
</div>
</header>

<section style="padding:14px;font-weight:800;font-size:16px;">
Student Full Details
</section>

<section class="apps-section" id="studentList"></section>

<!-- ===== EDIT DIALOG ===== -->
<div id="editDialog" class="confirm-dialog">
<div class="dialog-box">

<div class="dialog-title">Edit Student</div>

<input id="editName" placeholder="Name" class="cancel-btn"><br><br>
<input id="editDob" placeholder="DOB" class="cancel-btn"><br><br>
<input id="editAadhaar" placeholder="Aadhaar" class="cancel-btn"><br><br>
<input id="editMobile" placeholder="Mobile" class="cancel-btn"><br><br>
<input id="editEmail" placeholder="Email" class="cancel-btn"><br><br>
<input id="editUsername" placeholder="Username" class="cancel-btn"><br><br>
<input id="editPassword" placeholder="Password" class="cancel-btn"><br><br>
<input id="editGender" placeholder="Gender" class="cancel-btn"><br><br>

<div class="dialog-actions">
<button class="cancel-btn" id="cancelEdit">Cancel</button>
<button class="ok-btn" id="saveEdit">Save</button>
</div>

</div>
</div>

<!-- ===== DELETE DIALOG ===== -->
<div id="deleteDialog" class="confirm-dialog">
<div class="dialog-box">
<div class="dialog-title">Delete Student</div>
<div class="dialog-text">
Are you sure you want to delete this student account?
</div>

<div class="dialog-actions">
<button class="cancel-btn" id="cancelDelete">Cancel</button>
<button class="ok-btn" id="confirmDelete">Delete</button>
</div>

</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, onValue, remove, update }
from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig={
apiKey:"AIzaSyAHAQjn4sTuR9FiGF3ljRrFEMZQjsx-SHg",
databaseURL:"https://apni-duniya-b53d7-default-rtdb.firebaseio.com",
projectId:"apni-duniya-b53d7"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

const list=document.getElementById("studentList");

let selectedKey="";
let editKey="";

/* ===== LOAD STUDENTS WITH AVATAR ===== */
onValue(ref(db,"students"),snap=>{

list.innerHTML="";

if(!snap.exists()){
list.innerHTML=`<div class="empty-msg">No student signup yet.</div>`;
return;
}

snap.forEach(c=>{

const d=c.val();

/* ðŸ”¥ PROFILE AVATAR SAME AS PROFILE PAGE */
const avatar = d.gender==="female" ? "ðŸ‘§" : "ðŸ‘¦";

list.innerHTML+=`

<div class="app-card">

<div style="font-size:36px;">${avatar}</div>

<span style="font-weight:900;">${d.name}</span>

<div style="font-size:11px;">ID: ${c.key}</div>
<div style="font-size:11px;">DOB: ${d.dob}</div>
<div style="font-size:11px;">Aadhaar: ${d.aadhaar}</div>
<div style="font-size:11px;">Mobile: ${d.mobile}</div>
<div style="font-size:11px;">Email: ${d.email}</div>
<div style="font-size:11px;">Username: ${d.username}</div>
<div style="font-size:11px;">Password: ${d.password}</div>
<div style="font-size:11px;">Gender: ${d.gender}</div>

<div style="display:flex;gap:8px;margin-top:8px;">

<button class="cancel-btn"
onclick="openEdit(
'${c.key}',
'${d.name}',
'${d.dob}',
'${d.aadhaar}',
'${d.mobile}',
'${d.email}',
'${d.username}',
'${d.password}',
'${d.gender}'
)">
Edit
</button>

<button class="ok-btn"
onclick="openDelete('${c.key}')">
Delete
</button>

</div>

</div>

`;

});

});

/* ===== EDIT ===== */
window.openEdit=(key,name,dob,aadhaar,mobile,email,username,password,gender)=>{

editKey=key;

editName.value=name;
editDob.value=dob;
editAadhaar.value=aadhaar;
editMobile.value=mobile;
editEmail.value=email;
editUsername.value=username;
editPassword.value=password;
editGender.value=gender;

editDialog.style.display="flex";
};

cancelEdit.onclick=()=>{
editDialog.style.display="none";
};

saveEdit.onclick=()=>{

update(ref(db,"students/"+editKey),{
name:editName.value,
dob:editDob.value,
aadhaar:editAadhaar.value,
mobile:editMobile.value,
email:editEmail.value,
username:editUsername.value,
password:editPassword.value,
gender:editGender.value
});

editDialog.style.display="none";
};

/* ===== DELETE ===== */
window.openDelete=(key)=>{
selectedKey=key;
deleteDialog.style.display="flex";
};

cancelDelete.onclick=()=>{
deleteDialog.style.display="none";
};

confirmDelete.onclick=()=>{
remove(ref(db,"students/"+selectedKey));
deleteDialog.style.display="none";
};

</script>

</body>
</html>