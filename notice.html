<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>M.M Public School | Notice Board</title>
<!-- âœ… BASIC SEO -->
<meta name="description"
content="M.M Public School Mundeshwari Official Website. School Notices, Updates, Events and Announcements.">

<meta name="keywords"
content="MM Public School Mundeshwari, School Notices, Updates, Events">

<meta name="author" content="M.M Public School Mundeshwari">
<meta name="robots" content="index, follow">

<!-- âœ… GOOGLE VERIFICATION -->
<meta name="google-site-verification"
content="KPDw4haUQPcKgIXGNM0EbmGKwXwk76fNJI59VcJzwE0">

<!-- âœ… SOCIAL + GOOGLE LOGO -->
<meta property="og:title" content="M.M Public School Mundeshwari">
<meta property="og:description"
content="Official School Website - Notices and Updates">

<meta property="og:image"
content="https://mmpublicschool.github.io/mmpsm/logo.png">

<meta property="og:type" content="website">
<meta property="og:url" content="https://mmpsm.wuaze.com/">

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html, body {
    max-width: 100%;
    overflow-x: hidden;
    height: 100%;
}

body {
    font-family: 'Segoe UI', Arial, sans-serif;
    background: #f0f4fa;
    height: 100vh;
    overflow: hidden;
}

.app {
    display: flex;
    flex-direction: column;
    height: 100vh;
    width: 100%;
}

/* ===== HEADER ===== */
.header {
    background: linear-gradient(135deg, #0a2a66, #1e4b8f);
    color: #fff;
    padding: 12px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    width: 100%;
}

.header i {
    font-size: 20px;
    cursor: pointer;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: rgba(255,255,255,0.15);
    transition: 0.2s;
}

.header i:hover {
    background: rgba(255,255,255,0.25);
}

.school-box {
    text-align: center;
    flex: 1;
}

.school-top {
    font-weight: 800;
    font-size: 15px;
    letter-spacing: 0.5px;
}

.school-bottom {
    font-size: 11px;
    color: #ffd700;
    font-weight: 700;
    margin-top: 2px;
}

/* ===== BELL NOTIFICATION ===== */
.notification-icon {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
}

.notification-icon.active i {
    animation: bellShake 1s infinite ease-in-out;
    transform-origin: top center;
    color: #ffd700;
}

@keyframes bellShake {
    0%, 100% { transform: rotate(0); }
    25% { transform: rotate(20deg); }
    50% { transform: rotate(-20deg); }
    75% { transform: rotate(10deg); }
}

.notif-count {
    position: absolute;
    top: -5px;
    right: -5px;
    background: #ff4444;
    color: #fff;
    font-size: 11px;
    font-weight: 800;
    min-width: 20px;
    height: 20px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 4px;
    border: 2px solid white;
}

/* ===== CATEGORY BAR ===== */
.category-bar {
    display: flex;
    gap: 12px;
    padding: 16px;
    background: white;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    margin-bottom: 4px;
}

.cat-btn {
    flex: 1;
    padding: 14px 12px;
    border: none;
    border-radius: 40px;
    font-weight: 700;
    font-size: 14px;
    background: #f0f4fa;
    color: #0a2a66;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    cursor: pointer;
    transition: 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.cat-btn i {
    font-size: 16px;
}

.cat-btn.active {
    background: linear-gradient(135deg, #0a2a66, #1e4b8f);
    color: white;
    box-shadow: 0 8px 20px rgba(10,42,102,0.3);
}

/* ===== NOTICE AREA ===== */
.notice-area {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
    scroll-behavior: smooth;
}

/* ===== NOTICE CARD ===== */
.notice-card {
    background: white;
    padding: 20px;
    border-radius: 24px;
    margin-bottom: 16px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.05);
    border: 1px solid rgba(10,42,102,0.1);
    animation: slideUp 0.4s ease;
    position: relative;
    border-left: 6px solid #0a2a66;
}

@keyframes slideUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.notice-card.old {
    border-left: 6px solid #ff9800;
}

.notice-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
}

.notice-icon {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: linear-gradient(135deg, #e6ecff, #d6e0ff);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    color: #0a2a66;
    border: 2px solid #0a2a66;
}

.notice-title {
    flex: 1;
    font-size: 16px;
    font-weight: 800;
    color: #0a2a66;
}

.notice-desc {
    font-size: 14px;
    color: #444;
    margin: 12px 0;
    line-height: 1.6;
}

/* ===== LINK BUTTON ===== */
.notice-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: linear-gradient(135deg, #0a2a66, #1e4b8f);
    color: #fff;
    padding: 10px 20px;
    border-radius: 40px;
    font-size: 13px;
    font-weight: 700;
    text-decoration: none;
    margin: 12px 0 8px 0;
    transition: 0.3s;
    box-shadow: 0 4px 15px rgba(10,42,102,0.3);
}

.notice-link:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(10,42,102,0.4);
}

.notice-link i {
    font-size: 14px;
}

/* ===== DATE TIME ===== */
.notice-time {
    font-size: 12px;
    color: #ff9800;
    font-weight: 600;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px dashed #e0e7ff;
    display: flex;
    align-items: center;
    gap: 6px;
}

.notice-time i {
    color: #ff9800;
}

/* ===== SHIMMER LOADING ===== */
.shimmer {
    height: 120px;
    border-radius: 24px;
    margin-bottom: 16px;
    background: linear-gradient(90deg, #f0f4fa 25%, #e0e7ff 50%, #f0f4fa 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
}

@keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
}

/* ===== NOTIFICATION POPUP ===== */
.notif-popup {
    position: fixed;
    top: 70px;
    right: 16px;
    width: 320px;
    max-height: 450px;
    background: white;
    border-radius: 24px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    z-index: 9999;
    display: none;
    overflow: hidden;
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
}

.notif-header {
    background: linear-gradient(135deg, #0a2a66, #1e4b8f);
    color: white;
    padding: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 700;
}

.notif-header span {
    display: flex;
    align-items: center;
    gap: 8px;
}

.notif-header button {
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    padding: 6px 14px;
    border-radius: 30px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 600;
    transition: 0.2s;
}

.notif-header button:hover {
    background: rgba(255,255,255,0.3);
}

#notifList {
    max-height: 350px;
    overflow-y: auto;
}

.notif-item {
    padding: 16px;
    border-bottom: 1px solid #f0f0f0;
    transition: 0.2s;
}

.notif-item:hover {
    background: #f8f9ff;
}

.notif-tag {
    display: inline-block;
    padding: 3px 10px;
    border-radius: 30px;
    font-size: 10px;
    font-weight: 700;
    margin-bottom: 8px;
}

.notif-tag.new {
    background: #0a2a66;
    color: white;
}

.notif-tag.old {
    background: #ff9800;
    color: white;
}

.notif-title {
    font-weight: 800;
    color: #0a2a66;
    font-size: 14px;
    margin-bottom: 6px;
}

.notif-desc {
    font-size: 13px;
    color: #444;
    line-height: 1.5;
}

.notif-time {
    font-size: 11px;
    color: #666;
    margin-top: 8px;
    display: flex;
    align-items: center;
    gap: 4px;
}

.notif-time i {
    color: #ff9800;
}

/* ===== EMPTY STATE ===== */
.empty-state {
    text-align: center;
    padding: 60px 20px;
    background: white;
    border-radius: 24px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.05);
}

.empty-state i {
    font-size: 60px;
    color: #0a2a66;
    margin-bottom: 16px;
    opacity: 0.5;
}

.empty-state h3 {
    font-size: 20px;
    font-weight: 800;
    color: #0a2a66;
    margin-bottom: 8px;
}

.empty-state p {
    font-size: 14px;
    color: #666;
}

/* ===== STATS CARD ===== */
.stats-card {
    background: white;
    border-radius: 24px;
    padding: 16px;
    margin-bottom: 20px;
    display: flex;
    justify-content: space-around;
    box-shadow: 0 8px 20px rgba(0,0,0,0.05);
    border: 1px solid rgba(10,42,102,0.1);
}

.stat-item {
    text-align: center;
}

.stat-value {
    font-size: 22px;
    font-weight: 800;
    color: #0a2a66;
}

.stat-label {
    font-size: 11px;
    color: #666;
    margin-top: 4px;
}

/* ===== BOTTOM SPACE ===== */
.bottom-space {
    height: 20px;
}
</style>
</head>

<body>

<div class="app">

<!-- ===== HEADER ===== -->
<div class="header">

    <i class="fa-solid fa-arrow-left" onclick="window.location.href='index.html'"></i>

    <div class="school-box">
        <div class="school-top">MM PUBLIC SCHOOL</div>
        <div class="school-bottom">MUNDESHWARI</div>
    </div>

    <div class="notification-icon" id="openNotif">
        <i class="fa-regular fa-bell"></i>
        <span id="notifCount" class="notif-count">0</span>
    </div>

</div>

<!-- ===== CATEGORY BAR ===== -->
<div class="category-bar">
    <button id="newBtn" class="cat-btn active">
        <i class="fa-regular fa-newspaper"></i> New Notice
    </button>
    <button id="oldBtn" class="cat-btn">
        <i class="fa-regular fa-folder-open"></i> Old Notice
    </button>
</div>

<!-- ===== NOTICE AREA ===== -->
<div id="noticeArea" class="notice-area">
    <div class="shimmer"></div>
    <div class="shimmer"></div>
    <div class="shimmer"></div>
</div>

</div>

<!-- ===== NOTIFICATION POPUP ===== -->
<div id="notifPopup" class="notif-popup">
    <div class="notif-header">
        <span><i class="fa-regular fa-bell"></i> Notifications</span>
        <button id="clearNotifBtn">Clear All</button>
    </div>
    <div id="notifList"></div>
</div>

<!-- ===== CLEAR CONFIRM DIALOG ===== -->
<div id="clearDialog" class="popup" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); backdrop-filter:blur(5px); align-items:center; justify-content:center; z-index:10000;">
    <div style="background:white; padding:28px; border-radius:32px; width:90%; max-width:300px; text-align:center;">
        <div style="font-size:48px; margin-bottom:16px;">ðŸ””</div>
        <div style="font-weight:800; font-size:20px; color:#0a2a66; margin-bottom:8px;">Clear All?</div>
        <div style="color:#666; margin-bottom:20px;">All notifications will be permanently removed.</div>
        <div style="display:flex; gap:12px;">
            <button id="cancelClear" style="flex:1; padding:14px; border:none; border-radius:40px; background:#f0f0f0; font-weight:700; cursor:pointer;">Cancel</button>
            <button id="confirmClear" style="flex:1; padding:14px; border:none; border-radius:40px; background:#dc2626; color:white; font-weight:700; cursor:pointer;">Clear</button>
        </div>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, onValue, set, remove } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig={
    apiKey:"AIzaSyAHAQjn4sTuR9FiGF3ljRrFEMZQjsx-SHg",
    authDomain:"apni-duniya-b53d7.firebaseapp.com",
    databaseURL:"https://apni-duniya-b53d7-default-rtdb.firebaseio.com",
    projectId:"apni-duniya-b53d7"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

// DOM Elements
const noticeArea = document.getElementById("noticeArea");
const newBtn = document.getElementById("newBtn");
const oldBtn = document.getElementById("oldBtn");
const openNotif = document.getElementById("openNotif");
const notifPopup = document.getElementById("notifPopup");
const notifList = document.getElementById("notifList");
const notifCount = document.getElementById("notifCount");
const clearNotifBtn = document.getElementById("clearNotifBtn");
const clearDialog = document.getElementById("clearDialog");
const cancelClear = document.getElementById("cancelClear");
const confirmClear = document.getElementById("confirmClear");

let currentType = "new";

/* ===== FORMAT TIME ===== */
function formatTime(ts) {
    if (!ts) return "N/A";
    const date = new Date(ts);
    const now = new Date();
    const diff = Math.floor((now - date) / (1000 * 60));
    
    if (diff < 1) return "Just now";
    if (diff < 60) return diff + " min ago";
    if (diff < 120) return "1 hour ago";
    if (diff < 1440) return Math.floor(diff / 60) + " hours ago";
    
    const days = Math.floor(diff / 1440);
    if (days === 1) return "Yesterday";
    if (days < 7) return days + " days ago";
    
    return date.toLocaleDateString('en-IN', { 
        day: 'numeric', 
        month: 'short',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
}

/* ===== LOAD NOTICE ===== */
function loadNotice(type) {
    currentType = type;
    
    noticeArea.innerHTML = `
        <div class="shimmer"></div>
        <div class="shimmer"></div>
        <div class="shimmer"></div>
    `;

    onValue(ref(db, "mmpsm_notice_panel/" + type), (snap) => {
        noticeArea.innerHTML = "";

        if (!snap.exists()) {
            noticeArea.innerHTML = `
                <div class="empty-state">
                    <i class="fa-regular ${type === 'new' ? 'fa-newspaper' : 'fa-folder-open'}"></i>
                    <h3>No ${type === 'new' ? 'New' : 'Old'} Notices</h3>
                    <p>No notices have been uploaded by admin yet.</p>
                </div>
                <div class="bottom-space"></div>
            `;
            return;
        }

        let notices = [];
        snap.forEach(c => {
            notices.push({
                id: c.key,
                ...c.val()
            });
        });

        // Sort by time (newest first)
        notices.sort((a, b) => (b.time || 0) - (a.time || 0));

        notices.forEach(d => {
            const timeStr = formatTime(d.time);
            
            noticeArea.innerHTML += `
                <div class="notice-card ${type === 'old' ? 'old' : ''}">
                    <div class="notice-header">
                        <div class="notice-icon">
                            <i class="fa-regular ${type === 'new' ? 'fa-star' : 'fa-clock'}"></i>
                        </div>
                        <div class="notice-title">${d.title || "Notice"}</div>
                    </div>
                    
                    <div class="notice-desc">${d.desc || d.text || ""}</div>
                    
                    ${d.link ? `
                        <a href="${d.link}" target="_blank" class="notice-link">
                            <i class="fa-regular fa-link"></i> View Details
                            <i class="fa-regular fa-arrow-right"></i>
                        </a>
                    ` : ''}
                    
                    <div class="notice-time">
                        <i class="fa-regular fa-clock"></i> ${timeStr}
                    </div>
                </div>
            `;
        });

        noticeArea.innerHTML += '<div class="bottom-space"></div>';
    }, { onlyOnce: true });
}

/* ===== LOAD NOTIFICATIONS ===== */
function loadNotifications() {
    onValue(ref(db, "mmpsm_notice_notifications"), (snap) => {
        notifList.innerHTML = "";
        let total = 0;
        let unreadCount = 0;

        if (!snap.exists()) {
            notifList.innerHTML = `
                <div style="padding:40px 20px; text-align:center; color:#666;">
                    <i class="fa-regular fa-bell-slash" style="font-size:40px; margin-bottom:12px; opacity:0.5;"></i>
                    <p>No notifications</p>
                </div>
            `;
            notifCount.innerText = "0";
            openNotif.classList.remove("active");
            return;
        }

        let notifications = [];
        snap.forEach(c => {
            const d = c.val();
            notifications.push({
                id: c.key,
                ...d
            });
            if (!d.read) unreadCount++;
        });

        // Sort by time (newest first)
        notifications.sort((a, b) => (b.time || 0) - (a.time || 0));

        notifications.slice(0, 15).forEach(d => {
            total++;
            const timeStr = formatTime(d.time);
            const tag = d.noticeType === "old" ? "OLD" : "NEW";
            const tagClass = d.noticeType === "old" ? "old" : "new";
            
            notifList.innerHTML += `
                <div class="notif-item">
                    <span class="notif-tag ${tagClass}">${tag}</span>
                    <div class="notif-title">${d.title || "Notice"}</div>
                    <div class="notif-desc">${d.desc || d.text || ""}</div>
                    <div class="notif-time">
                        <i class="fa-regular fa-clock"></i> ${timeStr}
                    </div>
                </div>
            `;
        });

        notifCount.innerText = total > 9 ? "9+" : total;

        if (total > 0) {
            openNotif.classList.add("active");
        } else {
            openNotif.classList.remove("active");
        }
    });
}

/* ===== CATEGORY SWITCH ===== */
newBtn.onclick = () => {
    newBtn.classList.add("active");
    oldBtn.classList.remove("active");
    loadNotice("new");
};

oldBtn.onclick = () => {
    oldBtn.classList.add("active");
    newBtn.classList.remove("active");
    loadNotice("old");
};

/* ===== NOTIFICATION POPUP ===== */
openNotif.onclick = (e) => {
    e.stopPropagation();
    notifPopup.style.display = "block";
    
    // Mark all as read
    const notifRef = ref(db, "mmpsm_notice_notifications");
    onValue(notifRef, (snap) => {
        snap.forEach((child) => {
            set(ref(db, "mmpsm_notice_notifications/" + child.key + "/read"), true);
        });
    }, { onlyOnce: true });
};

document.addEventListener("click", (e) => {
    if (!notifPopup.contains(e.target) && !openNotif.contains(e.target)) {
        notifPopup.style.display = "none";
    }
});

/* ===== CLEAR NOTIFICATIONS ===== */
clearNotifBtn.onclick = () => {
    clearDialog.style.display = "flex";
};

cancelClear.onclick = () => {
    clearDialog.style.display = "none";
};

confirmClear.onclick = async () => {
    await set(ref(db, "mmpsm_notice_notifications"), null);
    clearDialog.style.display = "none";
    notifPopup.style.display = "none";
    loadNotifications();
};

// Close dialog on outside click
clearDialog.addEventListener('click', (e) => {
    if (e.target === clearDialog) {
        clearDialog.style.display = "none";
    }
});

// Initial loads
loadNotice("new");
loadNotifications();

// Extra Features: Add stats
const statsHTML = `
    <div class="stats-card">
        <div class="stat-item">
            <div class="stat-value">24/7</div>
            <div class="stat-label">Support</div>
        </div>
        <div class="stat-item">
            <div class="stat-value">100+</div>
            <div class="stat-label">Notices</div>
        </div>
        <div class="stat-item">
            <div class="stat-value">24h</div>
            <div class="stat-label">Response</div>
        </div>
    </div>
`;

// Insert stats after category bar
const categoryBar = document.querySelector('.category-bar');
categoryBar.insertAdjacentHTML('afterend', statsHTML);

</script>

</body>
</html>