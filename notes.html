<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>M.M Public School Mundeshwari â€“ Study Notes</title>
<meta name="description"
content="M.M Public School Mundeshwari Official Website. Online Admission, Notes, Test Series, Demo Class, Student Portal and School Updates.">

<meta name="keywords"
content="MM Public School Mundeshwari, school website, online admission, student portal, demo class, notes download, Bihar school">

<meta name="author" content="M.M Public School Mundeshwari">

<meta name="robots" content="index, follow">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Search Verification (à¤¬à¤¾à¤¦ à¤®à¥‡à¤‚ code à¤®à¤¿à¤²à¥‡à¤—à¤¾ à¤¤à¥‹ à¤¯à¤¹à¤¾à¤ à¤¡à¤¾à¤²à¤¨à¤¾) -->
<meta name="google-site-verification" content="PASTE_YOUR_CODE_HERE">
<link rel="stylesheet" href="style.css">
<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>

<!-- ===== HEADER ===== -->
<header class="header">

<div class="menu-icon">
<i class="fa-solid fa-bars"></i>
</div>

<div class="school-box">
<div class="school-top">M. M PUBLIC SCHOOL</div>
<div class="school-bottom">MUNDESHWARI</div>
</div>

<div class="right-icons">
<div class="notification-icon" id="openNotif">
<i class="fa-regular fa-bell"></i>
<span class="notif-count" id="notifCount">0</span>
</div>

<a href="signup.html">
<i class="fa-solid fa-user-plus"></i>
</a>
</div>

</header>

<!-- ðŸ”” NOTIFICATION POPUP -->
<div class="notif-popup" id="notifPopup">
<div class="notif-head">
Notifications
<button id="clearNotif">Clear</button>
</div>
<div id="notifList"></div>
</div>

<div class="confirm-dialog" id="confirmDialog">
<div class="dialog-box">
<div class="dialog-title">Clear Notifications</div>
<div class="dialog-text">Are you sure you want to delete all notifications?</div>
<div class="dialog-actions">
<button class="cancel-btn" id="cancelClear">Cancel</button>
<button class="ok-btn" id="confirmClear">Delete</button>
</div>
</div>
</div>

<section style="padding:14px;font-weight:800;font-size:16px;">
PDF Notes
</section>

<section class="apps-section" id="notesList"></section>

<!-- ===== PDF VIEWER ===== -->
<div id="pdfViewer" style="position:fixed;inset:0;background:#000;display:none;z-index:9999;">
<div id="closePdf"
style="position:absolute;top:10px;right:10px;color:#fff;font-size:22px;cursor:pointer;">
<i class="fa-solid fa-xmark"></i>
</div>
<iframe id="pdfFrame" style="width:100%;height:100%;border:none;background:#fff;"></iframe>
</div>

<!-- ===== LOADING SCREEN ===== -->
<div id="loadingScreen"
style="position:fixed;top:0;left:0;right:0;bottom:0;background:#000a;display:none;z-index:99999;justify-content:center;align-items:center;flex-direction:column;color:#fff;font-size:30px;font-weight:900;">
<span id="loadingCount">0</span>%
</div>

<!-- ===== SUCCESS DIALOG ===== -->
<div id="successDialog" class="confirm-dialog">
<div class="dialog-box">
<div class="dialog-title">Download Successful âœ…</div>
<div class="dialog-actions">
<button class="ok-btn" id="okSuccess">OK</button>
</div>
</div>
</div>

<!-- ===== NAVIGATION ===== -->
<nav class="bottom-nav">

<a href="index.html" class="nav-item">
<i class="fa-solid fa-house"></i>
<span>Home</span>
</a>

<a href="download.html" class="nav-item">
<i class="fa-solid fa-download"></i>
<span>Download</span>
</a>

<a href="notes.html" class="nav-item active">
<i class="fa-solid fa-book"></i>
<span>Notes</span>
</a>

<a href="profile.html" class="nav-item">
<i class="fa-solid fa-user"></i>
<span>Profile</span>
</a>

</nav>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, onValue, push, get, child, update, remove }
from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig={
apiKey:"AIzaSyAHAQjn4sTuR9FiGF3ljRrFEMZQjsx-SHg",
databaseURL:"https://apni-duniya-b53d7-default-rtdb.firebaseio.com",
projectId:"apni-duniya-b53d7"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

const list=document.getElementById("notesList");
const loading=document.getElementById("loadingScreen");
const loadingCount=document.getElementById("loadingCount");
const successDialog=document.getElementById("successDialog");

/* TIME */
function timeAgo(ts){
const diff=Math.floor((Date.now()-ts)/60000);
if(diff<=0)return"Just now";
if(diff==1)return"1 min";
return diff+" min";
}

/* VIEW PDF */
window.openPdf=(link)=>{
pdfViewer.style.display="block";
pdfFrame.src=link;
};

closePdf.onclick=()=>{
pdfViewer.style.display="none";
pdfFrame.src="";
};

/* DOWNLOAD */
window.downloadFile=async(name,link)=>{

loading.style.display="flex";
let num=0;

const timer=setInterval(async()=>{

num++;
loadingCount.innerText=num;

if(num>=100){

clearInterval(timer);
loading.style.display="none";

const a=document.createElement("a");
a.href=link;
a.download="";
document.body.appendChild(a);
a.click();
a.remove();

const snap=await get(child(ref(db),"downloads"));
let foundKey=null;
let oldCount=1;

if(snap.exists()){
snap.forEach(c=>{
const d=c.val();
if(d.name===name){
foundKey=c.key;
oldCount=d.count||1;
}
});
}

if(foundKey){
update(ref(db,"downloads/"+foundKey),{
count:oldCount+1,
time:Date.now()
});
}else{
push(ref(db,"downloads"),{
name:name,
link:link,
time:Date.now(),
count:1
});
}

successDialog.style.display="flex";

}

},15);

};

okSuccess.onclick=()=>{
successDialog.style.display="none";
};

/* LOAD NOTES */
onValue(ref(db,"notes"),snap=>{

list.innerHTML="";

if(!snap.exists()){
list.innerHTML=`
<div class="empty-msg">
No PDF notes have been uploaded yet.<br>
Please check again later or contact school administration for updates.
</div>`;
return;
}

snap.forEach(c=>{
const d=c.val();

list.innerHTML+=`
<div class="app-card">
<i class="fa-solid fa-file-pdf"></i>
<span>${d.name}</span>

<div style="display:flex;gap:8px;margin-top:6px;">
<button onclick="downloadFile('${d.name}','${d.link}')"
class="cancel-btn">Download</button>
<button onclick="openPdf('${d.link}')"
class="ok-btn">View</button>
</div>

</div>`;
});

});

/* ðŸ”” NOTIFICATION SAME AS PROFILE */
openNotif.onclick=e=>{
e.stopPropagation();
notifPopup.style.display="block";
};

document.addEventListener("click",e=>{
if(!notifPopup.contains(e.target)&&!openNotif.contains(e.target)){
notifPopup.style.display="none";
}
});

clearNotif.onclick=()=>{
confirmDialog.style.display="flex";
};

cancelClear.onclick=()=>confirmDialog.style.display="none";

confirmClear.onclick=()=>{
remove(ref(db,"notifications"));
confirmDialog.style.display="none";
};

onValue(ref(db,"notifications"),snap=>{

notifList.innerHTML="";
let arr=[];
let total=0;

snap.forEach(c=>arr.push(c.val()));

if(arr.length===0){
notifList.innerHTML=`
<div class="empty-msg">
No notification has been sent by M. M Public School.
</div>`;
notifCount.innerText="0";
openNotif.classList.remove("bell-blink");
return;
}

arr.sort((a,b)=>a.type==="important"?-1:1);

arr.forEach(d=>{
total++;
notifList.innerHTML+=`
<div class="notif-item ${d.type==="important"?"important":""}">
${d.text}
<div class="time">${timeAgo(d.time)}</div>
</div>`;
});

notifCount.innerText=total>9?"9+":total;

if(total>0){
openNotif.classList.add("bell-blink");
}
});

</script>

</body>
</html>