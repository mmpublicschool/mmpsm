<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M.M Public School Mundeshwari â€“ Student Profile</title>
<meta name="description"
content="M.M Public School Mundeshwari Official Website. Online Admission, Notes, Test Series, Demo Class, Student Portal and School Updates.">

<meta name="keywords"
content="MM Public School Mundeshwari, school website, online admission, student portal, demo class, notes download, Bihar school">

<meta name="author" content="M.M Public School Mundeshwari">

<meta name="robots" content="index, follow">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Search Verification (à¤¬à¤¾à¤¦ à¤®à¥‡à¤‚ code à¤®à¤¿à¤²à¥‡à¤—à¤¾ à¤¤à¥‹ à¤¯à¤¹à¤¾à¤ à¤¡à¤¾à¤²à¤¨à¤¾) -->
<meta name="google-site-verification" content="PASTE_YOUR_CODE_HERE">

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<link rel="stylesheet" href="style.css">

<style>
.profile-value{color:#1e63d6;font-weight:900;cursor:pointer;}
.delete-btn{
margin:14px;
background:#ff2d2d;
color:#fff;
padding:12px;
border-radius:14px;
text-align:center;
font-weight:900;
cursor:pointer;
}
</style>
</head>

<body>

<!-- ===== HEADER ===== -->
<header class="header">
<div class="menu-icon" id="menuBtn">
<i class="fa-solid fa-bars"></i>
</div>

<div class="school-box">
<div class="school-top">M. M PUBLIC SCHOOL</div>
<div class="school-bottom">MUNDESHWARI</div>
</div>

<div class="right-icons">
<div class="notification-icon" id="openNotif">
<i class="fa-regular fa-bell"></i>
<span class="notif-count" id="notifCount">0</span>
</div>
<a href="signup.html">
<i class="fa-solid fa-user-plus"></i>
</a>
</div>
</header>

<!-- ===== SIDE MENU ===== -->
<div class="side-menu" id="sideMenu">
<div class="menu-head">M. M PUBLIC SCHOOL</div>
<a href="index.html" class="menu-item"><i class="fa-solid fa-house"></i> Home</a>
<a href="download.html" class="menu-item"><i class="fa-solid fa-download"></i> Download</a>
<a href="notes.html" class="menu-item"><i class="fa-solid fa-book"></i> Notes</a>
<a href="profile.html" class="menu-item"><i class="fa-solid fa-user"></i> Profile</a>
</div>
<div class="menu-overlay" id="menuOverlay"></div>

<!-- ===== NOTIFICATION POPUP ===== -->
<div class="notif-popup" id="notifPopup">
<div class="notif-head">
Notifications
<button id="clearNotif">Clear</button>
</div>
<div id="notifList"></div>
</div>

<!-- ===== CONFIRM DIALOG ===== -->
<div class="confirm-dialog" id="confirmDialog">
<div class="dialog-box">
<div class="dialog-title">Are you sure?</div>
<div class="dialog-text">Do you really want to continue?</div>
<div class="dialog-actions">
<button class="cancel-btn" id="cancelClear">Cancel</button>
<button class="ok-btn" id="confirmClear">Yes</button>
</div>
</div>
</div>

<!-- ===== BIG DETAIL POPUP ===== -->
<div class="confirm-dialog" id="detailPopup">
<div class="dialog-box">
<div id="detailBig" style="font-size:22px;font-weight:900;"></div>
<div id="detailTime" style="margin-top:10px;"></div>
</div>
</div>

<!-- ===== PROFILE HERO ===== -->
<section class="hero">
<div class="hero-box" style="text-align:center">

<div id="avatar" style="font-size:48px;margin-bottom:10px;">ðŸ‘¦</div>
<div class="hero-title" id="nameText">Student Name</div>
<div class="hero-subtitle" id="schoolIdText">MMPSM</div>

</div>
</section>

<!-- ===== DETAILS ===== -->
<section class="apps-section">

<div class="app-card"><span>DOB</span><b id="dobText" class="profile-value"></b></div>
<div class="app-card"><span>Aadhaar</span><b id="aadhaarText" class="profile-value"></b></div>
<div class="app-card"><span>Mobile</span><b id="mobileText" class="profile-value"></b></div>
<div class="app-card"><span>Email</span><b id="emailText" class="profile-value"></b></div>
<div class="app-card"><span>Username</span><b id="usernameText" class="profile-value"></b></div>
<div class="app-card"><span>Gender</span><b id="genderText" class="profile-value"></b></div>

</section>

<div class="delete-btn" id="deleteAccount"> Delete Account</div>

<!-- ===== NAV ===== -->
<nav class="bottom-nav">
<a href="index.html" class="nav-item"><i class="fa-solid fa-house"></i><span>Home</span></a>
<a href="download.html" class="nav-item"><i class="fa-solid fa-download"></i><span>Download</span></a>
<a href="notes.html" class="nav-item"><i class="fa-solid fa-book"></i><span>Notes</span></a>
<a href="profile.html" class="nav-item active"><i class="fa-solid fa-user"></i><span>Profile</span></a>
</nav>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, get, onValue, remove }
from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig={
apiKey:"AIzaSyAHAQjn4sTuR9FiGF3ljRrFEMZQjsx-SHg",
databaseURL:"https://apni-duniya-b53d7-default-rtdb.firebaseio.com",
projectId:"apni-duniya-b53d7"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

function timeAgo(ts){
const diff=Math.floor((Date.now()-ts)/60000);
if(diff<=0)return "Just now";
if(diff==1)return "1 min";
return diff+" min";
}

/* MENU */
menuBtn.onclick=()=>{
sideMenu.classList.add("active");
menuOverlay.classList.add("active");
};
menuOverlay.onclick=()=>{
sideMenu.classList.remove("active");
menuOverlay.classList.remove("active");
};

/* SESSION */
const s=await get(ref(db,"session/currentUser"));
if(!s.exists()) location.href="signup.html";
const schoolId=s.val();

/* PROFILE DATA */
onValue(ref(db,"students/"+schoolId),snap=>{
const d=snap.val();

nameText.innerText=d.name;
schoolIdText.innerText=schoolId;
dobText.innerText=d.dob;
aadhaarText.innerText=d.aadhaar;
mobileText.innerText=d.mobile;
emailText.innerText=d.email;
usernameText.innerText=d.username;
genderText.innerText=d.gender;
avatar.innerText=d.gender==="female"?"ðŸ‘§":"ðŸ‘¦";
});

/* DETAIL POPUP */
document.querySelectorAll(".profile-value").forEach(el=>{
el.onclick=()=>{
detailPopup.style.display="flex";
detailBig.innerText=el.innerText;
detailTime.innerText="Added: Just now";
};
});
detailPopup.onclick=()=>detailPopup.style.display="none";

/* DELETE ACCOUNT */
deleteAccount.onclick=()=>{
confirmDialog.style.display="flex";
};

confirmClear.onclick=async()=>{
await remove(ref(db,"students/"+schoolId));
await remove(ref(db,"session/currentUser"));
location.href="signup.html";
};

cancelClear.onclick=()=>confirmDialog.style.display="none";

/* NOTIFICATION OPEN */
openNotif.onclick=e=>{
e.stopPropagation();
notifPopup.style.display="block";
};

document.addEventListener("click",e=>{
if(!notifPopup.contains(e.target)&&!openNotif.contains(e.target)){
notifPopup.style.display="none";
}
});

/* CLEAR DIALOG */
clearNotif.onclick=()=>{
confirmDialog.style.display="flex";
};

/* LOAD NOTIFICATION */
onValue(ref(db,"notifications"),snap=>{

notifList.innerHTML="";
let arr=[];
let total=0;

snap.forEach(c=>arr.push(c.val()));

if(arr.length===0){
notifList.innerHTML=
`<div class="empty-msg">
No notification has been sent by M. M Public School.
</div>`;
notifCount.innerText="0";
openNotif.classList.remove("bell-blink");
return;
}

/* IMPORTANT FIRST */
arr.sort((a,b)=>a.type==="important"?-1:1);

arr.forEach(d=>{
total++;
notifList.innerHTML+=`
<div class="notif-item ${d.type==="important"?"important":""}">
${d.text}
<div class="time">${timeAgo(d.time)}</div>
</div>`;
});

notifCount.innerText=total>9?"9+":total;

if(total>0){
openNotif.classList.add("bell-blink");
}
});

</script>
</body>
</html>