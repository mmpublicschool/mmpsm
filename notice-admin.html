<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>MM Public School - Notice Admin</title>

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>

/* ===== BODY ===== */
body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
background:#edf3ff;
}

/* ===== HEADER ===== */
.header{
background:linear-gradient(135deg,#0b3d91,#2563eb);
color:#fff;
padding:16px;
font-weight:900;
text-align:center;
}

/* ===== CARD ===== */
.card{
background:#fff;
margin:14px;
padding:18px;
border-radius:18px;
box-shadow:0 12px 24px rgba(0,0,0,.1);
}

label{
font-weight:900;
font-size:13px;
color:#0b3d91;
}

input,select,textarea{
width:100%;
box-sizing:border-box;
padding:13px;
margin:8px 0 14px;
border-radius:12px;
border:1px solid #e4e7f0;
font-size:14px;
background:#f7f9ff;
outline:none;
}

textarea{resize:none;height:80px;}

.ok-btn{
width:100%;
padding:14px;
border:none;
border-radius:14px;
background:linear-gradient(135deg,#0b3d91,#2563eb);
color:#fff;
font-weight:900;
font-size:15px;
cursor:pointer;
}

/* ===== HISTORY ===== */
.history-card{
background:#fff;
padding:14px;
border-radius:14px;
margin-bottom:12px;
box-shadow:0 8px 16px rgba(0,0,0,.08);
}

.h-title{
font-weight:900;
color:#0b3d91;
}

.h-desc{
font-size:13px;
margin:6px 0;
color:#333;
}

.h-time{
font-size:11px;
color:#ff6600;
font-weight:800;
}

.actions{
display:flex;
gap:8px;
margin-top:8px;
}

.edit-btn{
flex:1;
background:#ffd700;
border:none;
padding:10px;
border-radius:10px;
font-weight:900;
}

.delete-btn{
flex:1;
background:#ff3b3b;
color:#fff;
border:none;
padding:10px;
border-radius:10px;
font-weight:900;
}

/* ===== POPUP ===== */
.popup{
position:fixed;
inset:0;
background:#0007;
display:none;
align-items:center;
justify-content:center;
z-index:9999;
}

.popup-box{
background:#fff;
width:90%;
max-width:320px;
padding:20px;
border-radius:18px;
text-align:center;
box-shadow:0 20px 40px rgba(0,0,0,.2);
}

.popup-title{
font-weight:900;
color:#0b3d91;
margin-bottom:6px;
}

.popup-actions{
display:flex;
gap:10px;
margin-top:14px;
}

.cancel{
flex:1;
background:#eee;
border:none;
padding:10px;
border-radius:10px;
}

.ok{
flex:1;
background:#0b3d91;
color:#fff;
border:none;
padding:10px;
border-radius:10px;
font-weight:900;
}

</style>
</head>

<body>

<div class="header">MM PUBLIC SCHOOL - NOTICE ADMIN PANEL</div>

<div class="card">

<label>Notice Category</label>
<select id="type">
<option value="new">New Notice</option>
<option value="old">Old Notice</option>
</select>

<label>Title</label>
<input id="title">

<label>Description</label>
<textarea id="desc"></textarea>

<label>Link</label>
<input id="link">

<button id="uploadBtn" class="ok-btn">
Upload Notice
</button>

</div>

<div class="card">
<div style="font-weight:900;color:#0b3d91;margin-bottom:10px;">
Upload History
</div>
<div id="historyList"></div>
</div>

<!-- POPUP -->
<div id="popup" class="popup">
<div class="popup-box">

<div id="popupTitle" class="popup-title"></div>
<div id="popupText"></div>

<div class="popup-actions">
<button class="cancel" id="cancelBtn">Cancel</button>
<button class="ok" id="okBtn">OK</button>
</div>

</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, push, onValue, remove, update }
from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig={
apiKey:"AIzaSyAHAQjn4sTuR9FiGF3ljRrFEMZQjsx-SHg",
authDomain:"apni-duniya-b53d7.firebaseapp.com",
databaseURL:"https://apni-duniya-b53d7-default-rtdb.firebaseio.com",
projectId:"apni-duniya-b53d7"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

const popup=document.getElementById("popup");
const popupTitle=document.getElementById("popupTitle");
const popupText=document.getElementById("popupText");

let action=null;

function showDialog(title,text,cb){
popupTitle.innerText=title;
popupText.innerText=text;
popup.style.display="flex";
action=cb;
}

okBtn.onclick=()=>{
popup.style.display="none";
if(action) action();
};

cancelBtn.onclick=()=>{
popup.style.display="none";
};

/* ===== UPLOAD ===== */
uploadBtn.onclick=()=>{

if(!title.value||!desc.value||!link.value){
showDialog(
"Incomplete Form",
"Please fill Title, Description and Link before uploading."
);
return;
}

const typeVal=type.value;

push(ref(db,"mmpsm_notice_panel/"+typeVal),{
title:title.value,
desc:desc.value,
link:link.value,
time:Date.now()
});

push(ref(db,"mmpsm_notice_notifications"),{
title:title.value,
desc:desc.value,
noticeType:typeVal,
time:Date.now()
});

title.value="";
desc.value="";
link.value="";

showDialog("Success","Notice uploaded successfully.");

};

/* ===== LOAD HISTORY ===== */
onValue(ref(db,"mmpsm_notice_panel"),snap=>{

historyList.innerHTML="";

snap.forEach(group=>{
const typeName=group.key;

group.forEach(c=>{
const d=c.val();

historyList.innerHTML+=`

<div class="history-card">

<div class="h-title">[${typeName.toUpperCase()}] ${d.title}</div>

<div class="h-desc">${d.desc}</div>

<div class="h-time">
${new Date(d.time).toLocaleString()}
</div>

<div class="actions">

<button class="edit-btn"
onclick="editNotice('${typeName}','${c.key}','${d.title}','${d.desc}','${d.link}')">
Edit
</button>

<button class="delete-btn"
onclick="deleteNotice('${typeName}','${c.key}')">
Delete
</button>

</div>

</div>
`;
});

});

});

/* ===== DELETE ===== */
window.deleteNotice=(type,key)=>{
showDialog(
"Delete Notice",
"Are you sure you want to delete this notice?",
()=>{
remove(ref(db,"mmpsm_notice_panel/"+type+"/"+key));
}
);
};

/* ===== EDIT ===== */
window.editNotice=(type,key,t,d,l)=>{

title.value=t;
desc.value=d;
link.value=l;
type.value=type;

showDialog(
"Edit Mode",
"Make changes and press Upload to update notice."
);

};

</script>

</body>
</html>