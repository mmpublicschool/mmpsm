<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Help Test Series Admin</title>

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>

body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
background:#edf3ff;
}

.header{
background:linear-gradient(135deg,#0b3d91,#2563eb);
color:#fff;
padding:16px;
font-weight:900;
font-size:17px;
}

#list{padding:14px;}

/* ===== PROFESSIONAL CARD ===== */
.card{
background:#fff;
border-radius:18px;
padding:18px;
margin-bottom:14px;
box-shadow:0 14px 28px rgba(0,0,0,.15);
border-left:5px solid #2563eb;
position:relative;
animation:fadeUp .35s ease;
cursor:pointer;
transition:.3s;
}

.card:hover{
transform:translateY(-4px);
box-shadow:0 20px 40px rgba(0,0,0,.18);
}

.card.star{
border-left:6px solid #ffd700;
background:#fffdf3;
}

.subject{
font-weight:900;
color:#0b3d91;
font-size:19px;
}

.desc{
font-size:14px;
margin-top:6px;
color:#444;
}

.name{
margin-top:8px;
font-weight:800;
font-size:12px;
color:#222;
}

.time{
font-size:13px;
color:#ff6600;
font-weight:900;
margin-top:6px;
}

/* ===== 3 MENU ===== */
.menu-btn{
position:absolute;
right:12px;
top:12px;
font-size:22px;
cursor:pointer;
color:#0b3d91;
}

.menu{
position:absolute;
right:12px;
top:44px;
background:#fff;
border-radius:16px;
box-shadow:0 12px 26px rgba(0,0,0,.25);
display:none;
z-index:100;
overflow:hidden;
min-width:200px;
}

.menu div{
display:flex;
align-items:center;
gap:14px;
padding:14px;
font-weight:900;
cursor:pointer;
}

.menu div i{
color:#0b3d91;
}

.menu div:hover{background:#f2f6ff;}

@keyframes fadeUp{
from{opacity:0;transform:translateY(20px)}
to{opacity:1;transform:translateY(0)}
}

/* ===== POPUP PROFESSIONAL ===== */
.popup{
position:fixed;
inset:0;
background:#0007;
display:none;
align-items:center;
justify-content:center;
z-index:9999;
}

.box{
background:#fff;
padding:26px;
border-radius:22px;
width:92%;
max-width:360px;
animation:scale .25s ease;
border-top:6px solid #2563eb;
}

@keyframes scale{
from{transform:scale(.8)}
to{transform:scale(1)}
}

.title{
font-weight:900;
font-size:20px;
color:#0b3d91;
}

.info-card{
background:#f4f8ff;
padding:14px;
border-radius:12px;
margin-top:12px;
font-size:13px;
line-height:1.5;
}

.input{
width:100%;
padding:12px;
margin-top:10px;
border-radius:10px;
border:1px solid #ddd;
font-weight:700;
}

.btns{
display:flex;
gap:10px;
margin-top:16px;
}

.btns button{
flex:1;
padding:11px;
border:none;
border-radius:10px;
font-weight:900;
}

.ok{background:#0b3d91;color:#fff;}
.cancel{background:#ddd;}

.loading{
text-align:center;
padding:40px;
font-weight:900;
color:#0b3d91;
}

.bar{
width:140px;
height:6px;
background:#dde5ff;
margin:10px auto;
border-radius:50px;
overflow:hidden;
}

.bar span{
display:block;
height:100%;
width:40%;
background:linear-gradient(90deg,#0b3d91,#2563eb);
animation:slide 1s linear infinite;
}

@keyframes slide{
0%{transform:translateX(-120%)}
100%{transform:translateX(300%)}
}

</style>
</head>

<body>

<div class="header">Help Test Series Admin Panel</div>

<div id="list">
<div class="loading">
Loading Help Requests...
<div class="bar"><span></span></div>
</div>
</div>

<div id="dialog" class="popup">
<div class="box">

<div id="dialogTitle" class="title"></div>

<div id="dialogInfo" class="info-card"></div>

<input id="eSubject" class="input" placeholder="Subject">
<input id="eDesc" class="input" placeholder="Description">
<input id="eName" class="input" placeholder="Name">

<div class="btns">
<button id="okBtn" class="ok">OK</button>
<button class="cancel" onclick="dialog.style.display='none'">Cancel</button>
</div>

</div>
</div>

<script type="module">

import { initializeApp } from
"https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";

import { getDatabase, ref, onValue, remove, update }
from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig={
apiKey:"AIzaSyAHAQjn4sTuR9FiGF3ljRrFEMZQjsx-SHg",
authDomain:"apni-duniya-b53d7.firebaseapp.com",
databaseURL:"https://apni-duniya-b53d7-default-rtdb.firebaseio.com",
projectId:"apni-duniya-b53d7"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

let currentKey=null;
let currentData=null;
let actionType="";

/* ✅ TIME FORMAT FIXED */
function formatTime(ts){
const d=new Date(Number(ts));
let hr=d.getHours();
const ampm=hr>=12?"PM":"AM";
hr=hr%12||12;
let min=d.getMinutes();
min=min<10?"0"+min:min;
return hr+":"+min+" "+ampm;
}

onValue(ref(db,"help-test-series"),snap=>{

list.innerHTML="";

if(!snap.exists()){
list.innerHTML="<div class='loading'>No help request received yet</div>";
return;
}

snap.forEach(c=>{

const d=c.val();

const card=document.createElement("div");
card.className="card"+(d.star?" star":"");

card.innerHTML=`
<div class="menu-btn"><i class="fa-solid fa-ellipsis-vertical"></i></div>

<div class="subject">${d.subject}</div>
<div class="desc">${d.desc}</div>
<div class="name">${d.name}</div>
<div class="time">${formatTime(d.timestamp)}</div>

<div class="menu">
<div class="starBtn"><i class="fa-solid fa-star"></i> Highlight</div>
<div class="editBtn"><i class="fa-solid fa-pen"></i> Edit</div>
<div class="shareBtn"><i class="fa-solid fa-share"></i> Share</div>
<div class="deleteBtn"><i class="fa-solid fa-trash"></i> Delete</div>
</div>
`;

const menu=card.querySelector(".menu");

card.querySelector(".menu-btn").onclick=(e)=>{
e.stopPropagation();
menu.style.display="block";
};

document.onclick=()=>menu.style.display="none";

/* ✅ POPUP ONLY CARD DETAILS */
card.onclick=()=>{
dialogTitle.innerText=d.subject;
dialogInfo.innerHTML=`
<div class="subject">${d.subject}</div>
<div class="desc">${d.desc}</div>
<div class="name">${d.name}</div>
<div class="time">${formatTime(d.timestamp)}</div>
`;
dialog.style.display="flex";
};

function openDialog(type){
actionType=type;
currentKey=c.key;
currentData=d;

dialogTitle.innerText=type+" Help Request";

dialogInfo.innerHTML=`
<div class="subject">${d.subject}</div>
<div class="desc">${d.desc}</div>
<div class="name">${d.name}</div>
<div class="time">${formatTime(d.timestamp)}</div>
`;

eSubject.value=d.subject;
eDesc.value=d.desc;
eName.value=d.name;

dialog.style.display="flex";
}

card.querySelector(".starBtn").onclick=(e)=>{
e.stopPropagation();
openDialog("Highlight");
};

card.querySelector(".editBtn").onclick=(e)=>{
e.stopPropagation();
openDialog("Edit");
};

card.querySelector(".shareBtn").onclick=(e)=>{
e.stopPropagation();
openDialog("Share");
};

card.querySelector(".deleteBtn").onclick=(e)=>{
e.stopPropagation();
openDialog("Delete");
};

list.appendChild(card);

});

});

okBtn.onclick=()=>{

if(actionType==="Highlight"){
update(ref(db,"help-test-series/"+currentKey),
{star:!currentData.star});
}

if(actionType==="Edit"){
update(ref(db,"help-test-series/"+currentKey),{
subject:eSubject.value,
desc:eDesc.value,
name:eName.value
});
}

if(actionType==="Share"){
navigator.share?.({
title:eSubject.value,
text:eDesc.value
});
}

if(actionType==="Delete"){
remove(ref(db,"help-test-series/"+currentKey));
}

dialog.style.display="none";
};

</script>

</body>
</html>