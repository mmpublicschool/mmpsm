<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin Dashboard | M. M PUBLIC SCHOOL</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
    background: #eef2f6;
    padding: 20px;
    color: #1e293b;
}

/* Header */
.dashboard-header {
    margin-bottom: 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
}

.dashboard-header h1 {
    font-size: 24px;
    color: #0b3d5f;
    display: flex;
    align-items: center;
    gap: 10px;
}

.dashboard-header h1 i {
    color: #fbbf24;
}

.category-buttons {
    display: flex;
    gap: 12px;
}

.category-btn {
    padding: 12px 24px;
    border: none;
    border-radius: 40px;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.category-btn.active {
    background: #0b3d5f;
    color: white;
    box-shadow: 0 4px 12px rgba(11, 61, 95, 0.3);
}

.category-btn:not(.active) {
    background: white;
    color: #0b3d5f;
    border: 1px solid #0b3d5f;
}

.category-btn:hover {
    transform: translateY(-2px);
}

.category-btn i {
    font-size: 16px;
}

/* Cards */
.card {
    background: #ffffff;
    border-radius: 20px;
    padding: 22px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.04);
    margin-bottom: 25px;
    border: 1px solid #e9edf2;
    transition: transform 0.2s ease;
    display: none;
}

.card.active {
    display: block;
}

.card:hover {
    box-shadow: 0 12px 28px rgba(0, 0, 0, 0.08);
}

.card h3 {
    margin: 0 0 18px 0;
    color: #0b3d5f;
    font-size: 18px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    padding-bottom: 12px;
    border-bottom: 2px solid #f0f3f7;
}

.card h3 i {
    color: #fbbf24;
    font-size: 20px;
}

/* Form elements */
input, select {
    width: 100%;
    padding: 14px 16px;
    margin: 8px 0 16px 0;
    border-radius: 14px;
    border: 1.5px solid #e2e8f0;
    font-size: 14px;
    background: #f8fafc;
    transition: all 0.2s;
}

input:focus, select:focus {
    outline: none;
    border-color: #0b3d5f;
    background: #ffffff;
    box-shadow: 0 0 0 4px rgba(11, 61, 95, 0.1);
}

.action-btn {
    margin-top: 5px;
    padding: 14px 20px;
    border: none;
    border-radius: 14px;
    background: #0b3d5f;
    color: #ffffff;
    font-weight: 600;
    font-size: 15px;
    width: 100%;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.action-btn:hover {
    background: #0f4a72;
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(11, 61, 95, 0.2);
}

.action-btn:active {
    transform: translateY(0);
}

/* List items */
.list-item {
    background: #f8fafc;
    border-radius: 16px;
    padding: 16px;
    margin-top: 12px;
    border: 1px solid #e9edf2;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 14px;
    transition: all 0.2s;
}

.list-item:hover {
    background: #ffffff;
    border-color: #cbd5e1;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
}

.list-item span {
    color: #1e293b;
    font-weight: 500;
    flex: 1;
}

.actions {
    display: flex;
    gap: 8px;
}

.actions button {
    width: auto;
    padding: 8px 16px;
    margin: 0;
    font-size: 13px;
    border-radius: 30px;
    font-weight: 500;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 4px;
}

.delete {
    background: #dc2626;
    color: white;
}

.delete:hover {
    background: #b91c1c;
}

.edit {
    background: #f59e0b;
    color: white;
}

.edit:hover {
    background: #d97706;
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    align-items: center;
    justify-content: center;
    z-index: 2000;
}

.modal.active {
    display: flex;
}

.modal-content {
    background: white;
    border-radius: 24px;
    padding: 28px;
    width: 90%;
    max-width: 450px;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
}

.modal-content h3 {
    color: #0b3d5f;
    margin-bottom: 20px;
    font-size: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.modal-content input {
    margin-bottom: 20px;
}

.modal-actions {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
}

.modal-btn {
    padding: 12px 24px;
    border: none;
    border-radius: 40px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.modal-btn.save {
    background: #0b3d5f;
    color: white;
}

.modal-btn.save:hover {
    background: #0f4a72;
}

.modal-btn.cancel {
    background: #e2e8f0;
    color: #1e293b;
}

.modal-btn.cancel:hover {
    background: #cbd5e1;
}

/* Toast notification */
.toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    background: #0b3d5f;
    color: white;
    padding: 14px 28px;
    border-radius: 50px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    display: none;
    font-weight: 500;
    font-size: 15px;
    z-index: 1000;
    border: 1px solid rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(5px);
}

/* Empty state */
.empty-state {
    text-align: center;
    color: #94a3b8;
    padding: 30px 20px;
    font-size: 14px;
    background: #f8fafc;
    border-radius: 16px;
    border: 2px dashed #e2e8f0;
}

/* Responsive */
@media (min-width: 768px) {
    body {
        padding: 30px;
        max-width: 900px;
        margin: 0 auto;
    }
    
    .card {
        padding: 28px;
    }
}

@media (max-width: 480px) {
    .list-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
    }
    
    .actions {
        width: 100%;
        justify-content: flex-end;
    }
    
    .dashboard-header h1 {
        font-size: 20px;
    }
    
    .category-buttons {
        width: 100%;
    }
    
    .category-btn {
        flex: 1;
        justify-content: center;
    }
}
</style>
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

<div class="dashboard-header">
    <h1>
        <i class="fa-solid fa-shield-alt"></i>
        Admin Dashboard
    </h1>
    <div class="category-buttons">
        <button class="category-btn active" id="showNotificationBtn">
            <i class="fa-solid fa-bell"></i>
            Notifications
        </button>
        <button class="category-btn" id="showNoticeBtn">
            <i class="fa-solid fa-clipboard-list"></i>
            Notices
        </button>
    </div>
</div>

<!-- Notification Card -->
<div class="card active" id="notificationCard">
    <h3><i class="fa-solid fa-bell"></i> Send Notification</h3>
    <input id="text" placeholder="Enter notification message..." autocomplete="off">
    <select id="type">
        <option value="normal">üì¢ General Notification</option>
        <option value="important">‚ö†Ô∏è Urgent / Important</option>
    </select>
    <button class="action-btn" onclick="sendNotif()">
        <i class="fa-solid fa-paper-plane"></i>
        Send Notification
    </button>
</div>

<!-- Notice Card -->
<div class="card" id="noticeCard">
    <h3><i class="fa-solid fa-clipboard-list"></i> Add Notice</h3>
    <input id="noticeText" placeholder="Enter notice content..." autocomplete="off">
    <select id="noticeType">
        <option value="new">üÜï New Notice (Current)</option>
        <option value="old">üìå Old Notice (Archive)</option>
    </select>
    <button class="action-btn" onclick="sendNotice()">
        <i class="fa-solid fa-plus-circle"></i>
        Add Notice
    </button>
</div>

<!-- All Notifications -->
<div class="card" id="notificationsListCard">
    <h3><i class="fa-solid fa-bell"></i> All Notifications</h3>
    <div id="notifData"></div>
</div>

<!-- All Notices -->
<div class="card" id="noticesListCard">
    <h3><i class="fa-solid fa-list"></i> All Notices</h3>
    <div id="noticeData"></div>
</div>

<!-- Edit Modal -->
<div class="modal" id="editModal">
    <div class="modal-content">
        <h3><i class="fa-solid fa-pen"></i> Edit Content</h3>
        <input type="text" id="editInput" placeholder="Enter new content...">
        <div class="modal-actions">
            <button class="modal-btn cancel" onclick="closeModal()">Cancel</button>
            <button class="modal-btn save" onclick="saveEdit()">Save Changes</button>
        </div>
    </div>
</div>

<!-- Delete Modal -->
<div class="modal" id="deleteModal">
    <div class="modal-content">
        <h3><i class="fa-solid fa-trash"></i> Confirm Delete</h3>
        <p style="margin-bottom: 24px; color: #4a5568;">Are you sure you want to delete this item? This action cannot be undone.</p>
        <div class="modal-actions">
            <button class="modal-btn cancel" onclick="closeDeleteModal()">Cancel</button>
            <button class="modal-btn save" style="background: #dc2626;" onclick="confirmDelete()">Delete</button>
        </div>
    </div>
</div>

<div class="toast" id="toast"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, push, ref, onValue, remove, update } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyAHAQjn4sTuR9FiGF3ljRrFEMZQjsx-SHg",
    authDomain: "apni-duniya-b53d7.firebaseapp.com",
    databaseURL: "https://apni-duniya-b53d7-default-rtdb.firebaseio.com",
    projectId: "apni-duniya-b53d7",
    storageBucket: "apni-duniya-b53d7.firebasestorage.app",
    messagingSenderId: "178853058918",
    appId: "1:178853058918:web:91dfaa5c5e41446da290a7",
    measurementId: "G-SW5SH1V2BB"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Get elements
const textInput = document.getElementById('text');
const noticeTextInput = document.getElementById('noticeText');
const typeSelect = document.getElementById('type');
const noticeTypeSelect = document.getElementById('noticeType');
const notifData = document.getElementById('notifData');
const noticeData = document.getElementById('noticeData');
const toast = document.getElementById('toast');

// Modal elements
const editModal = document.getElementById('editModal');
const deleteModal = document.getElementById('deleteModal');
const editInput = document.getElementById('editInput');

// Current item being edited/deleted
let currentEditId = null;
let currentEditType = null;
let currentEditPath = null;
let currentDeleteId = null;
let currentDeletePath = null;

// Category buttons
const showNotificationBtn = document.getElementById('showNotificationBtn');
const showNoticeBtn = document.getElementById('showNoticeBtn');
const notificationCard = document.getElementById('notificationCard');
const noticeCard = document.getElementById('noticeCard');
const notificationsListCard = document.getElementById('notificationsListCard');
const noticesListCard = document.getElementById('noticesListCard');

// Category switching
showNotificationBtn.addEventListener('click', () => {
    showNotificationBtn.classList.add('active');
    showNoticeBtn.classList.remove('active');
    notificationCard.classList.add('active');
    noticeCard.classList.remove('active');
    notificationsListCard.classList.add('active');
    noticesListCard.classList.remove('active');
});

showNoticeBtn.addEventListener('click', () => {
    showNoticeBtn.classList.add('active');
    showNotificationBtn.classList.remove('active');
    noticeCard.classList.add('active');
    notificationCard.classList.remove('active');
    noticesListCard.classList.add('active');
    notificationsListCard.classList.remove('active');
});

// Toast function
function showToast(message) {
    toast.innerText = message;
    toast.style.display = 'block';
    setTimeout(() => {
        toast.style.display = 'none';
    }, 2500);
}

// Modal functions
window.openEditModal = (id, path, currentText) => {
    currentEditId = id;
    currentEditPath = path;
    editInput.value = currentText;
    editModal.classList.add('active');
};

window.closeModal = () => {
    editModal.classList.remove('active');
    currentEditId = null;
    currentEditPath = null;
    editInput.value = '';
};

window.saveEdit = () => {
    if (!editInput.value.trim()) {
        showToast('Content cannot be empty');
        return;
    }
    
    if (currentEditId && currentEditPath) {
        update(ref(db, currentEditPath + '/' + currentEditId), { 
            text: editInput.value 
        });
        showToast('Content updated successfully');
        closeModal();
    }
};

window.openDeleteModal = (id, path) => {
    currentDeleteId = id;
    currentDeletePath = path;
    deleteModal.classList.add('active');
};

window.closeDeleteModal = () => {
    deleteModal.classList.remove('active');
    currentDeleteId = null;
    currentDeletePath = null;
};

window.confirmDelete = () => {
    if (currentDeleteId && currentDeletePath) {
        remove(ref(db, currentDeletePath + '/' + currentDeleteId));
        showToast('Item deleted successfully');
        closeDeleteModal();
    }
};

// Send Notification
window.sendNotif = () => {
    if (!textInput.value.trim()) {
        showToast('Please enter notification content');
        return;
    }
    push(ref(db, 'notifications'), {
        text: textInput.value,
        type: typeSelect.value,
        time: Date.now()
    });
    showToast('Notification sent successfully');
    textInput.value = '';
};

// Send Notice
window.sendNotice = () => {
    if (!noticeTextInput.value.trim()) {
        showToast('Please enter notice content');
        return;
    }
    push(ref(db, 'notice/' + noticeTypeSelect.value), {
        text: noticeTextInput.value,
        time: Date.now()
    });
    showToast('Notice added successfully');
    noticeTextInput.value = '';
};

// Load Notifications
onValue(ref(db, 'notifications'), (snap) => {
    if (!snap.exists()) {
        notifData.innerHTML = '<div class="empty-state"><i class="fa-regular fa-bell-slash"></i> No notifications available</div>';
        return;
    }
    notifData.innerHTML = '';
    snap.forEach((child) => {
        const data = child.val();
        const id = child.key;
        const typeIcon = data.type === 'important' ? '‚ö†Ô∏è' : 'üì¢';
        const typeLabel = data.type === 'important' ? 'Urgent' : 'General';
        
        notifData.innerHTML += `
        <div class="list-item">
            <span><strong>${typeIcon} [${typeLabel}]</strong> ${data.text}</span>
            <div class="actions">
                <button class="edit" onclick='openEditModal("${id}", "notifications", "${data.text.replace(/'/g, "\\'")}")'>
                    <i class="fa-solid fa-pen"></i> Edit
                </button>
                <button class="delete" onclick='openDeleteModal("${id}", "notifications")'>
                    <i class="fa-solid fa-trash"></i> Delete
                </button>
            </div>
        </div>`;
    });
});

// Load Notices
onValue(ref(db, 'notice'), (snap) => {
    if (!snap.exists()) {
        noticeData.innerHTML = '<div class="empty-state"><i class="fa-regular fa-file-lines"></i> No notices available</div>';
        return;
    }
    noticeData.innerHTML = '';
    snap.forEach((typeSnap) => {
        typeSnap.forEach((child) => {
            const data = child.val();
            const id = child.key;
            const typeName = typeSnap.key;
            const typeIcon = typeName === 'new' ? 'üÜï' : 'üìå';
            const typeLabel = typeName === 'new' ? 'Current' : 'Archived';
            
            noticeData.innerHTML += `
            <div class="list-item">
                <span><strong>${typeIcon} [${typeLabel}]</strong> ${data.text}</span>
                <div class="actions">
                    <button class="edit" onclick='openEditModal("${id}", "notice/${typeName}", "${data.text.replace(/'/g, "\\'")}")'>
                        <i class="fa-solid fa-pen"></i> Edit
                    </button>
                    <button class="delete" onclick='openDeleteModal("${id}", "notice/${typeName}")'>
                        <i class="fa-solid fa-trash"></i> Delete
                    </button>
                </div>
            </div>`;
        });
    });
});

// Make functions global
window.sendNotif = sendNotif;
window.sendNotice = sendNotice;
</script>

</body>
</html>